 MySQL 高级

## 视图

通俗的讲，视图就是一条 select 语句执行后返回的结果集，通常是对若干张基本表的引用，是一张虚表。通过对视图的引用，可以避免修改数据库结构便需要修改代码的麻烦，而且可以减少复杂的 SQL 语句的使用，增强可读性。

建议以 v_ 开头定义视图 

```sql
create view 视图名称 as select语句;
-- 以 jing_dong 数据库为例建视图 v_goods_info
create view v_goods_info as 
select g.*, c.name as cate_name, b.name as brand_name from goods as g 
left join goods_cates as c on g.cate_id=c.id 
left join goods_brands as b on g.brand_id=b.id;
-- 查看视图
show tables;
-- 使用视图
-- 视图多用于查询
-- 当视图中包含如下结构，便不可对其修改：聚合函数、distinct 关键字、group by 、order by 子句等
select name, brand_name, cate_name from v_goods_info;
-- 删除视图
drop view 视图名称;
```

视图的作用

* 提高重用性
* 对数据库重构时，不影响程序的运行
* 提高了安全性能，可以对不同权限的用户提供不同的视图
* 让数据更加清晰，增加可读性

## 事务

事务是一个操作序列，这些操作要么都执行，要么都不执行，是一个不可分割的工作单位。如从一个账号扣款然后另一个账号收款，这两个操作要么都执行，要么都不执行，这可视为一个事务。

事务有如下四大特性（ACID）

* 原子性（Atomicity）

  > 一个事务中的所有操作要么全部提交成功（commit），要么全部失败回滚（rollback），不可以只执行其中一部分。

* 一致性（Consistency）

  > 数据库总是从一个一致性的状态转换到另一个一致性的状态。

* 隔离性（Isolation）

  > 一个事务所做的修改在最终提交以前，对其他事务是不可见的。

* 持久性（Durability）

  > 一旦事务提交，则其所做的修改会永久保存到数据库。

表的引擎类型必须是 Innodb 类型才可以使用事务。可以通过查看表的创建命令 `show create table 表名` 来确定。



## 索引